<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Bootstrap-estimate of Flux-error — bootstrap_error • ConFluxPro</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bootstrap-estimate of Flux-error — bootstrap_error"><meta name="description" content="Bootstrap-estimate of Flux-error"><meta property="og:description" content="Bootstrap-estimate of Flux-error"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ConFluxPro</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/overview.html">overview</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Bootstrap-estimate of Flux-error</h1>

      <div class="d-none name"><code>bootstrap_error.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Bootstrap-estimate of Flux-error</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bootstrap_error</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  n_samples <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  sd_x_ppm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_replicates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_from <span class="op">=</span> <span class="st">"gasdata"</span>,</span>
<span>  rep_cols <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'cfp_pfres'</span></span>
<span><span class="fu">bootstrap_error</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  n_samples <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  sd_x_ppm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_replicates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_from <span class="op">=</span> <span class="st">"gasdata"</span>,</span>
<span>  rep_cols <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">make_bootstrap_model</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  n_samples <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  sd_x_ppm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_replicates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_from <span class="op">=</span> <span class="st">"gasdata"</span>,</span>
<span>  rep_cols <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'cfp_pfres'</span></span>
<span><span class="fu">make_bootstrap_model</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  n_samples <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  sd_x_ppm <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_replicates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_from <span class="op">=</span> <span class="st">"gasdata"</span>,</span>
<span>  rep_cols <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">calculate_bootstrap_error</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'cfp_pfres'</span></span>
<span><span class="fu">calculate_bootstrap_error</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>cfp_pfres</code> model result from a call to <code><a href="pro_flux.html">pro_flux()</a></code>.</p></dd>


<dt id="arg-n-samples">n_samples<a class="anchor" aria-label="anchor" href="#arg-n-samples"></a></dt>
<dd><p>The number of samples to take in the bootstrapping.</p></dd>


<dt id="arg-sd-x-ppm">sd_x_ppm<a class="anchor" aria-label="anchor" href="#arg-sd-x-ppm"></a></dt>
<dd><p>An optional estimate of the standard deviation of x_ppm. Can
be either</p><ul><li><p>a single value applied equally to all</p></li>
<li><p>a data.frame with a column of the same name that
maps a value to every observation depth. See <code><a href="depth_structure.html">depth_structure()</a></code> for an easy
way to create it.</p></li>
<li><p>be provided as its own column already present in <code>x$gasdata</code>.</p></li>
</ul></dd>


<dt id="arg-n-replicates">n_replicates<a class="anchor" aria-label="anchor" href="#arg-n-replicates"></a></dt>
<dd><p>The number of replicates to be generated if sd_x_ppm is
set.</p></dd>


<dt id="arg-sample-from">sample_from<a class="anchor" aria-label="anchor" href="#arg-sample-from"></a></dt>
<dd><p>From which dataset to sample the bootstrapping dataset.
Can either be <code>'gasdata'</code> or <code>'soilphys'</code> or <code>'both'</code>.</p></dd>


<dt id="arg-rep-cols">rep_cols<a class="anchor" aria-label="anchor" href="#arg-rep-cols"></a></dt>
<dd><p>The id_cols that represent repetitions. If removed, the
repetitions in soilphys of each profile must match in their structure exactly.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>The result of the bootstrap model.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>x with added columns DELTA_flux and DELTA_prod as an estimate
of the error of of the corresponding columns in the same units.</p>
    </div>
    <div class="section level2">
    <h2 id="general-procedure">General procedure<a class="anchor" aria-label="anchor" href="#general-procedure"></a></h2>
    <p><code>bootstrap_error()</code> is mostly a wrapper around two functions that can also be
run separately.</p>
<p>In <code>make_bootstrap_model()</code>, for <code>sample_from = "gasdata"</code> the
<code>gasdata</code> concentration data is resampled for every depth and profile
a total number of <code>n_samples</code>. This is done by randomly sampling the
observations at each depth without changing the number of observations but
while allowing replacing. If <code>rep_cols</code> are given, these columns are
removed from the <code>id_cols</code> and the resulting profiles combined as one.</p>
<p>For <code>sample_from = "soilphys"</code>, the <code>soilphys</code> data is combined
using the <code>rep_cols</code> as repetitions. Among every remaining profile and
depth, one observation across all repetitions is chosen for each of
<code>n_samples</code>. <code>sample_from = "both"</code> applies both methods above.
Each newly sampled profile is identifiable by the
added <code>bootstrap_id</code> column which is also added to <code>id_cols</code>.</p>
<p>After this new model is run again, the bootstap error is caculated in
<code>calculate_bootstrap_error()</code>. This is the standard deviation of the
production and flux parameters across all bootstrapped model runs and is
calculated for each profile and layer of the original model, or for each
destinct profile in the new model without <code>rep_cols</code>.
These are returned together with the mean values of <code>prod</code>, <code>flux</code>
and <code>F0</code> across all runs in the <code>PROFLUX</code> data.frame and can
thereby be extracted by <code><a href="efflux.html">efflux()</a></code> and <code><a href="production.html">production()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="artificial-observations-in-gasdata">Artificial observations in gasdata<a class="anchor" aria-label="anchor" href="#artificial-observations-in-gasdata"></a></h2>
    <p>If there are not enough observations per depth (e.g.) because there is only
one measurement per depth, it is possible to create artificial observations
by providing <code>n_replicates</code> and <code>sd_x_ppm</code>. Here, every depth of
every profile is first averaged to its mean (redundant if there is only one
observation). Then, a random dataset of <code>n_replicates</code> observations
is generated that is normally distributed around the mean with a standard
deviation (in ppm) of <code>sd_x_ppm</code>. These observations are then resampled
as described above. Note that this error should be representative of the
sampling error in the field and not the measurement error of the measurement
device, which is much lower.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">PROFLUX</span> <span class="op">&lt;-</span> <span class="fu"><a href="pro_flux.html">pro_flux</a></span><span class="op">(</span><span class="fu">ConFluxPro</span><span class="fu">::</span><span class="va"><a href="base_dat.html">base_dat</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">PROFLUX_BSE</span> <span class="op">&lt;-</span> <span class="fu">bootstrap_error</span><span class="op">(</span><span class="va">PROFLUX</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> validating datasets</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> id_cols: site, Date, gas, bootstrap_id</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1200 unique profiles</span>
<span class="r-in"><span><span class="fu"><a href="efflux.html">efflux</a></span><span class="op">(</span><span class="va">PROFLUX_BSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A cfp_profile object </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> id_cols: site Date gas </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24  unique profiles </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      site       Date gas     efflux prof_id DELTA_efflux</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  site_a 2021-01-01 CO2  0.8429610       1   0.02633798</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  site_b 2021-01-01 CO2  0.6763911       2   0.01389758</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  site_a 2021-02-01 CO2  1.3784963       3   0.02182533</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  site_b 2021-02-01 CO2  1.0666943       4   0.01496520</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  site_a 2021-03-01 CO2  1.7424766       5   0.03833253</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  site_b 2021-03-01 CO2  1.3910526       6   0.01160696</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  site_a 2021-04-01 CO2  4.1396328       7   0.04253622</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  site_b 2021-04-01 CO2  3.3456025       8   0.05015449</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  site_a 2021-05-01 CO2  5.9676759       9   0.08219772</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 site_b 2021-05-01 CO2  4.4710172      10   0.05518122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 site_a 2021-06-01 CO2  7.2678452      11   0.09628114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 site_b 2021-06-01 CO2  5.6783657      12   0.07184852</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 site_a 2021-07-01 CO2 10.1469971      13   0.14381006</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 site_b 2021-07-01 CO2  8.5688079      14   0.10590895</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 site_a 2021-08-01 CO2  8.0515776      15   0.17054155</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 site_b 2021-08-01 CO2  6.9149107      16   0.10510296</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 site_a 2021-09-01 CO2  6.2443430      17   0.12090202</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18 site_b 2021-09-01 CO2  5.2440922      18   0.07166082</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19 site_a 2021-10-01 CO2  3.9959103      19   0.12215896</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20 site_b 2021-10-01 CO2  3.2447621      20   0.04116001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21 site_a 2021-11-01 CO2  1.7529403      21   0.03401804</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22 site_b 2021-11-01 CO2  1.5550672      22   0.02664799</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23 site_a 2021-12-01 CO2  1.2077043      23   0.02362541</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24 site_b 2021-12-01 CO2  1.0862780      24   0.01307257</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">PROFLUX_BSE</span> <span class="op">&lt;-</span> <span class="fu">bootstrap_error</span><span class="op">(</span><span class="va">PROFLUX</span>, n_replicates <span class="op">=</span> <span class="fl">5</span>, sd_x_ppm <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Adding gasdata replicates as normal distribution of 5 samples around the mean.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> validating datasets</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> id_cols: site, Date, gas, bootstrap_id</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1200 unique profiles</span>
<span class="r-in"><span><span class="fu"><a href="efflux.html">efflux</a></span><span class="op">(</span><span class="va">PROFLUX_BSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A cfp_profile object </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> id_cols: site Date gas </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24  unique profiles </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      site       Date gas     efflux prof_id DELTA_efflux</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  site_a 2021-01-01 CO2  0.8305233       1   0.06948057</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  site_b 2021-01-01 CO2  0.6892845       2   0.02745311</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  site_a 2021-02-01 CO2  1.3804727       3   0.08592559</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  site_b 2021-02-01 CO2  1.0707094       4   0.03843973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  site_a 2021-03-01 CO2  1.7922332       5   0.05939070</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  site_b 2021-03-01 CO2  1.4254358       6   0.05062181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  site_a 2021-04-01 CO2  3.9879387       7   0.07492112</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  site_b 2021-04-01 CO2  3.3984600       8   0.05472674</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  site_a 2021-05-01 CO2  5.9539752       9   0.11643840</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 site_b 2021-05-01 CO2  4.4455024      10   0.05375143</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 site_a 2021-06-01 CO2  7.2869279      11   0.06354410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 site_b 2021-06-01 CO2  5.7311535      12   0.12859636</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 site_a 2021-07-01 CO2 10.2930064      13   0.09670892</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 site_b 2021-07-01 CO2  8.5694332      14   0.05257841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 site_a 2021-08-01 CO2  8.1051011      15   0.08165216</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 site_b 2021-08-01 CO2  6.8545510      16   0.03590167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 site_a 2021-09-01 CO2  6.2131739      17   0.05900213</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18 site_b 2021-09-01 CO2  5.1480204      18   0.04868803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19 site_a 2021-10-01 CO2  4.1011940      19   0.09327191</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20 site_b 2021-10-01 CO2  3.2164744      20   0.06264923</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21 site_a 2021-11-01 CO2  1.6770558      21   0.09037221</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22 site_b 2021-11-01 CO2  1.5688890      22   0.03856545</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23 site_a 2021-12-01 CO2  1.1152357      23   0.07114110</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24 site_b 2021-12-01 CO2  0.9891861      24   0.02978153</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Valentin Gartiser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

